function sort_keys(){for(var e="",s=[],c=32;c<127;c++)keys[c].hits>0&&s.push(keys[c]);s.sort(function(e,s){return parseFloat(e.accuracy)-parseFloat(s.accuracy)});for(var c=0;c<s.length;c++){var a="<span>"+s[c].key+"</span><span>"+s[c].hits+"</span><span>"+s[c].correct+"</span><span>"+s[c].accuracy+"</span>";e+="<div class = '"+s[c].bg_class+"'>"+a+"</div>"}return e}function get_class(e,s){var c={key_class:"",div_class:"",format:0};return s>=65&&s<=90&&(c.key_class=" o_line "),s>=48&&s<=57&&(c.format=2),123!=s&&125!=s&&58!=s&&34!=s&&124!=s&&60!=s&&62!=s&&63!=s&&95!=s&&43!=s||(c.key_class=" o_line "),e>95?(c.key_class+="blue",c.div_class="bg_blue"):e>90?(c.key_class+="light_blue",c.div_class="bg_light_blue"):e>85?(c.key_class+="green",c.div_class="bg_green"):e>80?(c.key_class+="light_green",c.div_class="bg_light_green"):e>75?(c.key_class+="yellow",c.div_class="bg_yellow"):e>70?(c.key_class+="orange",c.div_class="bg_orange"):e>60?(c.key_class+="red_1",c.div_class="bg_red_1"):(c.key_class+="red_2",c.div_class="bg_red_2"),c}function get_numeric_div(e){switch(e){case 49:return 33;case 50:return 64;case 51:return 35;case 52:return 36;case 53:return 37;case 54:return 94;case 55:return 38;case 57:return 40;case 48:return 41;case 91:return 123;case 93:return 125;case 59:return 58;case 39:return 34;case 92:return 124;case 44:return 60;case 46:return 62;case 47:return 63}}function toFixed(e,s){var s=s||0,c=e<0,a=Math.pow(10,s),e=Math.round(e*a),r=String((c?Math.ceil:Math.floor)(e/a)),i=String((c?-e:e)%a),t=new Array(Math.max(s-i.length,0)+1).join("0");return s?r+"."+t+i:r}for(var key_pressed,keys=[],i=32;i<127;i++){if(keys[i]={hits:0,correct:0,accuracy:0,key:"",code:0,div_id:"#key_"+i,bg_class:"",key_class:"",compute_accuracy:function(){this.accuracy=toFixed(this.correct/this.hits*100,2)}},keys[i].code=i,keys[i].key=String.fromCharCode(keys[i].code),keys[32].key="space",i>=65&&i<=90){var temp=String.fromCharCode(i).toLowerCase().charCodeAt(0);keys[i].div_id="#key_"+temp}if(i>=48&&i<=57){var temp=get_numeric_div(i);keys[i].div_id="#key_"+temp}if(91==i||93==i||59==i||39==i||92==i||44==i||46==i||47==i){var temp=get_numeric_div(i);keys[i].div_id="#key_"+temp}}self.onmessage=function(e){var s,c={highlight:{div_id:"",code:0,div_class:"",format:0},update:s},a={},r=e.data;0==r.close?("right"==r.status?(keys[r.code].hits++,keys[r.code].correct++,keys[r.code].compute_accuracy(),a=get_class(parseInt(keys[r.code].accuracy),r.code),keys[r.code].bg_class=a.div_class,keys[r.code].key_class=a.key_class,c.highlight.format=a.format,s=sort_keys()):(keys[r.code].hits++,keys[r.code].compute_accuracy(),a=get_class(parseInt(keys[r.code].accuracy),r.code),keys[r.code].bg_class=a.div_class,keys[r.code].key_class=a.key_class,c.highlight.format=a.format,s=sort_keys()),c.highlight.div_id=keys[r.code].div_id,c.highlight.code=keys[r.code].code,c.highlight.div_class=keys[r.code].key_class,c.update=s,self.postMessage(JSON.stringify(c))):1==r.close&&self.close()};